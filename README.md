# –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç–∏ –¥–ª—è 1–°-–ë–∏—Ç—Ä–∏–∫—Å

–í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∏ –æ—Ç–ø—É—Å–∫–Ω—ã—Ö —Ü–µ–Ω –ø–æ–ª–∏–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–¥—É–∫—Ü–∏–∏, –≤—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ–µ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å 1–°-–ë–∏—Ç—Ä–∏–∫—Å.

## –û–ø–∏—Å–∞–Ω–∏–µ

–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç **—Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ iframe** –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ –ë–∏—Ç—Ä–∏–∫—Å. –ü–æ–∑–≤–æ–ª—è–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º:
- –°–æ–∑–¥–∞–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –∏–∑ –¥–µ—Ç–∞–ª–µ–π, –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤, –æ–ø–µ—Ä–∞—Ü–∏–π –∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è
- –†–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å –≥–∞–±–∞—Ä–∏—Ç—ã, –≤–µ—Å, —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å –∏ –æ—Ç–ø—É—Å–∫–Ω—ã–µ —Ü–µ–Ω—ã
- –°–æ—Ö—Ä–∞–Ω—è—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∫ —Ç–æ—Ä–≥–æ–≤—ã–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º

**–í–∞–∂–Ω–æ:** –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–∫–∞–ª—å–Ω—ã –¥–æ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏ ¬´–°–æ—Ö—Ä–∞–Ω–∏—Ç—å¬ª.

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
npm install
npm run dev
```

–î–ª—è —Å–±–æ—Ä–∫–∏ –ø—Ä–æ–¥–∞–∫—à–Ω-–≤–µ—Ä—Å–∏–∏:
```bash
npm run build
```

–†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞–∑–º–µ—â–∞–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –ø–æ –ø—É—Ç–∏: `/local/apps/prospektweb.calc/`

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### üìñ –û—Å–Ω–æ–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**[docs/bitrix-integration.md](./docs/bitrix-integration.md)** ‚Äî –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:
- –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏ —Ä–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã
- –î–æ–º–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å (–ø—Ä–æ–¥—É–∫—Ç—ã, –¢–ü, –º–∞—Ç–µ—Ä–∏–∞–ª—ã, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏)
- –ü—Ä–æ—Ç–æ–∫–æ–ª postMessage —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ pwcode –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ UI
- –ü—Ä–∏–º–µ—Ä—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –Ω–∞ JavaScript –∏ PHP

### üìò –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

- **[README_INTEGRATION.md](./README_INTEGRATION.md)** ‚Äî –∫—Ä–∞—Ç–∫–∏–π –æ–±–∑–æ—Ä –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- **[PRD.md](./PRD.md)** ‚Äî —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø—Ä–æ–¥—É–∫—Ç—É
- **test-integration.html** ‚Äî —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã

**NEW_CONFIG** ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏  
–ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –∫–æ–≥–¥–∞:
- –£ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –¢–ü –Ω–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –£ –¢–ü —Ä–∞–∑–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

**EXISTING_CONFIG** ‚Äî —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π  
–ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –∫–æ–≥–¥–∞:
- –£ –≤—Å–µ—Ö –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –¢–ü –æ–¥–∏–Ω–∞–∫–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü—Ä–æ—Ç–æ–∫–æ–ª postMessage (v1.0.0)

–ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è:

```
iframe ‚Üí –ë–∏—Ç—Ä–∏–∫—Å: READY (–∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∑–∞–≥—Ä—É–∂–µ–Ω)
–ë–∏—Ç—Ä–∏–∫—Å ‚Üí iframe: INIT (–ø–µ—Ä–µ–¥–∞—á–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏ –¥–∞–Ω–Ω—ã—Ö)
iframe ‚Üí –ë–∏—Ç—Ä–∏–∫—Å: INIT_DONE (–≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ)
...—Ä–∞–±–æ—Ç–∞ —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π...
iframe ‚Üí –ë–∏—Ç—Ä–∏–∫—Å: CALC_PREVIEW (—Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞—Å—á—ë—Ç–∞)
...–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"...
iframe ‚Üí –ë–∏—Ç—Ä–∏–∫—Å: SAVE_REQUEST (–∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ)
–ë–∏—Ç—Ä–∏–∫—Å ‚Üí iframe: RESPONSE (—Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è)
```

### –ü—Ä–∏–º–µ—Ä –±–∞–∑–æ–≤–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

```javascript
const iframe = document.getElementById('calc-iframe');

window.addEventListener('message', (event) => {
    const msg = event.data;
    if (msg.source !== 'prospektweb.calc') return;
    
    switch (msg.type) {
        case 'READY':
            // –û—Ç–ø—Ä–∞–≤–∏—Ç—å INIT —Å –¥–∞–Ω–Ω—ã–º–∏
            iframe.contentWindow.postMessage({
                source: 'bitrix',
                target: 'prospektweb.calc',
                type: 'INIT',
                payload: {
                    mode: 'NEW_CONFIG',
                    context: { siteId, userId, lang: 'ru' },
                    iblocks: { materials, operations, ... },
                    selectedOffers: [...]
                }
            }, '*');
            break;
            
        case 'SAVE_REQUEST':
            // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏ –æ–±–Ω–æ–≤–∏—Ç—å –¢–ü
            await saveConfiguration(msg.payload);
            break;
    }
});
```

–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –≤ [docs/bitrix-integration.md](./docs/bitrix-integration.md)

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
/workspaces/spark-template/
‚îú‚îÄ‚îÄ docs/
‚îÇ   ‚îî‚îÄ‚îÄ bitrix-integration.md     # –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ calculator/           # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ui/                   # UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (shadcn)
‚îÇ   ‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ use-postmessage.ts    # Hook –¥–ª—è postMessage
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ use-custom-drag.ts    # Drag & drop
‚îÇ   ‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ postmessage-bridge.ts # –Ø–¥—Ä–æ postMessage API
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ types.ts              # TypeScript —Ç–∏–ø—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ mock-data.ts          # –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
‚îÇ   ‚îî‚îÄ‚îÄ App.tsx                   # –ì–ª–∞–≤–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
‚îú‚îÄ‚îÄ test-integration.html         # –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
‚îú‚îÄ‚îÄ README_INTEGRATION.md         # –ö—Ä–∞—Ç–∫–∏–π –æ–±–∑–æ—Ä
‚îî‚îÄ‚îÄ PRD.md                        # Product requirements
```

## –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

‚úÖ –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –∏–∑ –¥–µ—Ç–∞–ª–µ–π –∏ —Å–∫—Ä–µ–ø–ª–µ–Ω–∏–π  
‚úÖ Drag & Drop –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Ä—è–¥–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤  
‚úÖ –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤/–æ–ø–µ—Ä–∞—Ü–∏–π/–æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è  
‚úÖ –†–∞—Å—á—ë—Ç –≥–∞–±–∞—Ä–∏—Ç–æ–≤, –≤–µ—Å–∞, —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç–∏, –æ—Ç–ø—É—Å–∫–Ω—ã—Ö —Ü–µ–Ω  
‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è –∏ –Ω–∞—Ü–µ–Ω–æ–∫ —Å "–∫—Ä–∞—Å–∏–≤—ã–º–∏" —Ü–µ–Ω–∞–º–∏  
‚úÖ –°—Ç–∞–±–∏–ª—å–Ω—ã–µ pwcode –¥–ª—è –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ UI  
‚úÖ –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å 1–°-–ë–∏—Ç—Ä–∏–∫—Å —á–µ—Ä–µ–∑ postMessage

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- React 19 + TypeScript
- Tailwind CSS + shadcn/ui
- Vite
- Phosphor Icons
- Sonner (—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è)

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –õ–æ–∫–∞–ª—å–Ω–æ

```bash
npm run dev
# –û—Ç–∫—Ä–æ–π—Ç–µ test-integration.html –≤ –±—Ä–∞—É–∑–µ—Ä–µ
```

### –° –ë–∏—Ç—Ä–∏–∫—Å

1. –°–æ–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç: `npm run build`
2. –†–∞–∑–º–µ—Å—Ç–∏—Ç–µ —Ñ–∞–π–ª—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤ `/local/apps/prospektweb.calc/`
3. –°–æ–∑–¥–∞–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å iframe –≤ –∞–¥–º–∏–Ω–∫–µ
4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ postMessage

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤:
1. –ò–∑—É—á–∏—Ç–µ [docs/bitrix-integration.md](./docs/bitrix-integration.md)
2. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ø—Ä–∏–º–µ—Ä—ã –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ test-integration.html –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License - Copyright GitHub, Inc.
